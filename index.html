<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join Clenzzo</title>
    
    <!-- 1. Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Google Font: Montserrat -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- 3. Custom Styling & Tailwind Configuration (TEAL THEME) -->
    <style type="text/tailwindcss">
        body {
            font-family: 'Montserrat', sans-serif;
            scroll-behavior: smooth;
        }
        
        .form-input, .form-select, .form-textarea {
            @apply w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition duration-200;
        }
        
        .form-textarea-small {
            @apply w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition duration-200;
        }

        .is-invalid {
            @apply border-red-500 focus:ring-red-500;
        }
        .validation-message {
            @apply text-red-400 text-xs mt-1 h-4; /* h-4 keeps layout stable */
        }

        .btn {
            @apply inline-block w-full font-bold py-3 px-5 rounded-lg transition duration-300 ease-in-out text-center transform;
            @apply hover:scale-105 active:scale-95;
        }
        
        .btn-primary {
            @apply bg-teal-500 text-white hover:bg-teal-600 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-opacity-75;
            @apply hover:shadow-lg hover:shadow-teal-500/30;
        }
        
        .btn-secondary {
            @apply bg-slate-600 text-white hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:ring-opacity-75;
        }
        
        .btn-disabled {
            @apply bg-slate-700 text-slate-400 cursor-not-allowed transform-none hover:scale-100;
        }

        .question-step {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        .fade-out {
            opacity: 0;
            transform: translateX(-20px);
        }
        .fade-in {
            opacity: 1;
            transform: translateX(0);
        }
        #question-flow-wrapper {
            position: relative;
            min-height: 250px; 
        }

        .segment-card {
            @apply bg-slate-900 p-4 rounded-lg border border-slate-700 flex items-center justify-between transition duration-300;
        }
        .segment-card-todo { @apply hover:bg-slate-700 hover:border-teal-500 cursor-pointer; }
        .segment-card-inprogress { @apply hover:bg-slate-700 hover:border-teal-500 cursor-pointer; }
        .segment-card-complete { @apply border-green-700 hover:bg-green-900/50 cursor-pointer; }
    </style>
</head>

<body class="bg-slate-900 text-white min-h-screen flex items-center justify-center p-4">

    <!-- Main Application Container -->
    <div id="app-container" class="w-full max-w-lg mx-auto bg-slate-800 rounded-2xl shadow-2xl overflow-hidden">

        <!-- ===== Persistent Header (Hidden on Welcome) ===== -->
        <div id="app-header" class="p-4 border-b border-slate-700 hidden">
            <img src="https://lh3.googleusercontent.com/d/1mAxNMp4-N-4FpIi_BPZZfCCaK5RCxVUH" 
                 alt="Clenzzo Logo" 
                 class="h-8 w-auto" 
                 onerror="this.style.display='none'">
        </div>

        <!-- ===== PAGE 1: WELCOME ===== -->
        <div id="page-welcome" class="p-6 md:p-8">
            <div class="text-center mb-6"><img src="https://lh3.googleusercontent.com/d/1mAxNMp4-N-4FpIi_BPZZfCCaK5RCxVUH" alt="Clenzzo Logo" class="h-16 w-auto mx-auto mb-4" onerror="this.style.display='none'; document.getElementById('logo-fallback').classList.remove('hidden')"><span id="logo-fallback" class="text-4xl font-bold text-teal-400 hidden">CLENZZO</span><p class="text-sm text-slate-400">Premium Waterless Car Care</p></div>
            <h1 class="text-2xl font-bold text-white mb-4 text-center">Join the Clenzzo Revolution</h1>
            <p class="text-slate-300 mb-6">We're looking for partners, not just employees, to help us become India‚Äôs #1 cleaning partner.</p>
            
            <!-- NEW: Desktop/Mobile Note -->
            <div class="p-3 bg-slate-900 rounded-lg border border-slate-700 mb-6 text-center">
                <p class="text-slate-300 text-sm">For the best experience, we recommend applying on a **mobile device**.</p>
            </div>

            <div class="p-4 bg-slate-900 rounded-lg border border-slate-700 mb-6"><h3 class="font-bold text-white text-lg mb-2">Know Us First!</h3><p class="text-slate-300 text-sm mb-3">Before you apply, please visit our website to understand our mission and services.</p><a href="https://clenzzo.com" target="_blank" rel="noopener noreferrer" class="inline-block w-full text-center bg-slate-700 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-600 transition duration-200">Visit clenzzo.com</a></div>
            <h2 class="text-xl font-bold text-white mb-4">Who We're Looking For</h2>
            <div class="flex flex-wrap gap-2 mb-6"><span class="bg-teal-800 text-teal-100 py-1 px-3 rounded-full text-sm font-medium">Ambitious & Driven</span><span class="bg-teal-800 text-teal-100 py-1 px-3 rounded-full text-sm font-medium">Customer-Obsessed</span><span class="bg-teal-800 text-teal-100 py-1 px-3 rounded-full text-sm font-medium">Punctual & Reliable</span><span class="bg-teal-800 text-teal-100 py-1 px-3 rounded-full text-sm font-medium">A Team Player</span></div>
            <h2 class="text-xl font-bold text-white mb-4">What We Offer</h2>
            <div class="space-y-3 text-slate-300 mb-8"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-teal-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg><span>Employee Development Programs</span></div><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-teal-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.783-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" /></svg><span>Quarterly Promotions & Appraisals</span></div><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-teal-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" /></svg><span>Competitive Salary & Incentives</span></div><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-teal-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.653-.084-1.284-.24-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.653.084-1.284.24-1.857m11.52 0l-1.52-1.52a3 3 0 00-4.24 0l-1.52 1.52m3-3l-4.5-4.5-4.5 4.5m1.5-1.5l.75.75M3 18v-2a3 3 0 013-3h12a3 3 0 013 3v2" /></svg><span>A Supportive & Driven Team</span></div></div>
            <button id="start-btn" class="btn btn-primary">Start Application</button>
        </div>

        <!-- ===== PAGE 2: DISCLAIMER ===== -->
        <div id="page-disclaimer" class="p-6 md:p-8 hidden">
            <h1 class="text-3xl font-bold text-white mb-4">Our Mutual Commitment</h1>
            <p class="text-slate-400 mb-6">We believe in transparency. Here's what we agree on:</p>
            <div class="space-y-4 text-slate-300"><div class="flex items-start gap-4 p-4 bg-slate-900 rounded-lg border border-slate-700"><span class="text-2xl mt-1">üìÖ</span><div><h3 class="font-bold text-white">3-Month Probation</h3><p class="text-sm text-slate-400">A 90-day period at 60% salary for us to ensure we're a perfect fit.</p></div></div><div class="flex items-start gap-4 p-4 bg-slate-900 rounded-lg border border-slate-700"><span class="text-2xl mt-1">ü§ù</span><div><h3 class="font-bold text-white">1-Year Commitment</h3><p class="text-sm text-slate-400">We invest a lot in your training and ask for a 1-year commitment in return.</p></div></div><div class="flex items-start gap-4 p-4 bg-slate-900 rounded-lg border border-slate-700"><span class="text-2xl mt-1">‚è∞</span><div><h3 class="font-bold text-white">Working Hours</h3><p class="text-sm text-slate-400">5am-6pm (Operations) or 9am-6pm (Admin/Marketing), as per your role.</p></div></div></div>
            <div class="mt-6 flex items-center"><input type="checkbox" id="agree-checkbox" class="h-5 w-5 bg-slate-700 border-slate-600 text-teal-500 focus:ring-teal-500 rounded"><label for="agree-checkbox" class="ml-3 text-slate-300">I have read and agree to these terms.</label></div>
            <button id="disclaimer-continue-btn" class="btn btn-disabled mt-6" disabled>I Agree & Continue</button>
        </div>

        <!-- ===== PAGE 3: NAME CAPTURE (NEW) ===== -->
        <div id="page-name-capture" class="p-6 md:p-8 hidden">
            <h1 class="text-3xl font-bold text-white mb-4">Let's get started</h1>
            <p class="text-slate-400 mb-6">First, what's your full name?</p>
            
            <div id="name-capture-form">
                <label for="fullName" class="block text-xl font-bold mb-3">Full Name</label>
                <input type="text" id="fullName" name="fullName" class="form-input" placeholder="e.g., Ramesh Kumar" required>
                <div id="fullName-error" class="validation-message"></div>
            </div>
            
            <button id="name-continue-btn" class="btn btn-primary mt-6">Continue</button>
        </div>

        <!-- ===== PAGE 4: SEGMENT HUB (NEW) ===== -->
        <div id="page-segment-hub" class="p-6 md:p-8 hidden">
            <h1 id="hub-greeting" class="text-3xl font-bold text-white mb-2">Welcome!</h1>
            <p class="text-slate-400 mb-6">Let's get your details. Please complete all segments.</p>
            <div class="mb-6"><div class="flex justify-between items-center text-sm text-slate-300 mb-1"><span>Overall Progress</span><span id="overall-progress-text">0/6 Segments</span></div><div class="w-full bg-slate-700 rounded-full h-2.5"><div id="overall-progress-bar" class="bg-teal-500 h-2.5 rounded-full" style="width: 0%; transition: width 0.3s ease;"></div></div></div>
            <div id="segment-list" class="space-y-3"></div>
            <button id="hub-submit-btn" class="btn btn-disabled mt-8" disabled>Proceed to Final Review</button>
        </div>

        <!-- ===== PAGE 5: QUESTION FLOW (NEW) ===== -->
        <div id="page-question-flow" class="p-6 md:p-8 hidden">
            <h1 id="question-flow-title" class="text-2xl font-bold text-white mb-6">Editing Segment</h1>
            <div class="mb-6"><div class="flex justify-between items-center text-sm text-slate-300 mb-1"><span id="segment-progress-label">Step 1 of X</span><button id="question-flow-back-btn" class="text-sm text-teal-400 hover:text-teal-300">&larr; Back to Hub</button></div><div class="w-full bg-slate-700 rounded-full h-2.5"><div id="segment-progress-bar" class="bg-teal-500 h-2.5 rounded-full" style="width: 0%; transition: width 0.3s ease;"></div></div></div>
            <p id="personal-greeting" class="text-teal-300 mb-4 text-lg hidden"></p>

            <div id="question-flow-wrapper">
                <form id="application-form">
                    
                    <!-- Segment 1: Basic Info -->
                    <div class="question-step" data-step="0" data-segment="basicInfo">
                        <label for="fullName-q" class="block text-xl font-bold mb-3">Confirm your full name:</label>
                        <input type="text" id="fullName-q" name="fullName-q" class="form-input" placeholder="e.g., Ramesh Kumar" required>
                        <div id="fullName-q-error" class="validation-message"></div>
                    </div>
                    <div class="question-step hidden" data-step="1" data-segment="basicInfo">
                        <label for="email" class="block text-xl font-bold mb-3">What's your email address?</label>
                        <input type="email" id="email" name="email" class="form-input" placeholder="Email Address" required>
                        <div id="email-error" class="validation-message"></div>
                    </div>
                    <div class="question-step hidden" data-step="2" data-segment="basicInfo">
                        <label for="phone" class="block text-xl font-bold mb-3">And your 10-digit phone number?</label>
                        <input type="tel" id="phone" name="phone" class="form-input" placeholder="10-Digit Phone Number" required>
                        <div id="phone-error" class="validation-message"></div>
                    </div>
                    <div class="question-step hidden" data-step="3" data-segment="basicInfo">
                        <label for="maritalStatus" class="block text-xl font-bold mb-3">What's your marital status?</label>
                        <select id="maritalStatus" name="maritalStatus" class="form-select" required><option value="" disabled selected>Select...</option><option value="Single">Single</option><option value="Married">Married</option></select>
                        <div id="maritalStatus-error" class="validation-message"></div>
                    </div>
                    <div class="question-step hidden" data-step="4" data-segment="basicInfo">
                        <label for="placeOfBirth" class="block text-xl font-bold mb-3">Where were you born?</label>
                        <input type="text" id="placeOfBirth" name="placeOfBirth" class="form-input" placeholder="Place of Birth" required>
                        <div id="placeOfBirth-error" class="validation-message"></div>
                    </div>
                    <div class="question-step hidden" data-step="5" data-segment="basicInfo">
                        <label for="currentAddress" class="block text-xl font-bold mb-3">What's your current address?</label>
                        <textarea id="currentAddress" name="currentAddress" class="form-textarea" rows="3" placeholder="Current Address" required></textarea>
                        <div id="currentAddress-error" class="validation-message"></div>
                    </div>

                    <!-- Segment 2: Role & Motivation -->
                    <div class="question-step hidden" data-step="6" data-segment="roleMotivation">
                        <label for="position" class="block text-xl font-bold mb-3">Which position are you applying for?</label>
                        <select id="position" name="position" class="form-select" required>
                            <option value="" disabled selected>Select a position...</option>
                            <option value="Supervising Officer">Supervising Officer</option><option value="Detailer">Detailer</option><option value="Admin Executive">Admin Executive</option><option value="Sales Executive">Sales Executive</option><option value="Marketing Executive">Marketing Executive</option>
                        </select>
                        <div id="position-error" class="validation-message"></div>
                        <div id="position-details" class="mt-3 p-3 bg-slate-900 rounded-lg text-slate-300 border border-slate-700 text-sm hidden">Please select a position to see qualities.</div>
                    </div>
                    <div class="question-step hidden" data-step="7" data-segment="roleMotivation">
                        <label for="salary" class="block text-xl font-bold mb-3">What is your monthly salary expectation?</label>
                        <select id="salary" name="salary" class="form-select" required>
                            <option value="" disabled selected>Select a range (in-hand)...</option>
                            <option value="8,000 - 15,000">‚Çπ8,000 - ‚Çπ15,000</option><option value="15,000 - 20,000">‚Çπ15,000 - ‚Çπ20,000</option><option value="20,000 - 25,000">‚Çπ20,000 - ‚Çπ25,000</option><option value="25,000 - 30,000">‚Çπ25,000 - ‚Çπ30,000</option><option value="30,000+">‚Çπ30,000+</option>
                        </select>
                        <div id="salary-error" class="validation-message"></div>
                    </div>
                    <div class="question-step hidden" data-step="8" data-segment="roleMotivation">
                        <label for="whyClenzzo" class="block text-xl font-bold mb-3">Why are you interested in working for Clenzzo?</label>
                        <textarea id="whyClenzzo" name="whyClenzzo" class="form-textarea" rows="4" placeholder="What motivates you about this role or our company?" required maxlength="300"></textarea>
                        <div id="whyClenzzo-error" class="validation-message"></div>
                        <div id="whyClenzzo-counter" class="text-xs text-slate-400 text-right mt-1">0 / 300</div>
                    </div>

                    <!-- Segment 3: Education & Experience -->
                    <div class="question-step hidden" data-step="9" data-segment="eduExperience">
                        <label for="qualification" class="block text-xl font-bold mb-3">What's your highest qualification?</label>
                        <input type="text" id="qualification" name="qualification" class="form-input" placeholder="e.g., B.Com, 12th Std" required>
                        <div id="qualification-error" class="validation-message"></div>
                    </div>
                    <div class="question-step hidden" data-step="10" data-segment="eduExperience">
                        <label for="discipline" class="block text-xl font-bold mb-3">What was your discipline/subject?</label>
                        <input type="text" id="discipline" name="discipline" class="form-input" placeholder="e.g., Commerce, Science (Optional)">
                        <div id="discipline-error" class="validation-message"></div> <!-- Optional, so no error -->
                    </div>
                    <div class="question-step hidden" data-step="11" data-segment="eduExperience">
                        <label for="educationPlace" class="block text-xl font-bold mb-3">What's the name of your school/college?</label>
                        <input type="text" id="educationPlace" name="educationPlace" class="form-input" placeholder="Place of Education" required>
                        <div id="educationPlace-error" class="validation-message"></div>
                    </div>
                    <div class="question-step hidden" data-step="12" data-segment="eduExperience">
                        <label for="hasExperience" class="block text-xl font-bold mb-3">Do you have any work experience?</label>
                        <select id="hasExperience" name="hasExperience" class="form-select" required><option value="No" selected>No (I am a fresher)</option><option value="Yes">Yes</option></select>
                        <div id="hasExperience-error" class="validation-message"></div>
                    </div>
                    <div class="question-step hidden" data-step="13" data-segment="eduExperience">
                        <label class="block text-xl font-bold mb-3">Great, please add your experience.</label>
                        <div id="experience-container" class="mt-4 space-y-3"></div>
                        <button type="button" id="add-experience-btn" class="btn btn-secondary mt-3 text-sm py-2">Add Another Experience</button>
                    </div>

                    <!-- Segment 4: Skills & Languages -->
                    <div class="question-step hidden" data-step="14" data-segment="skillsLanguages">
                        <label for="skillMotorcycle" class="block text-xl font-bold mb-3">Can you ride a motorcycle?</label>
                        <select id="skillMotorcycle" name="skillMotorcycle" class="form-select" required><option value="" disabled selected>Select...</option><option value="Yes">Yes</option><option value="No">No</option></select>
                        <div id="skillMotorcycle-error" class="validation-message"></div>
                    </div>
                    <div class="question-step hidden" data-step="15" data-segment="skillsLanguages">
                        <label for="skillCar" class="block text-xl font-bold mb-3">Do you know how to drive a car?</label>
                        <select id="skillCar" name="skillCar" class="form-select" required><option value="" disabled selected>Select...</option><option value="Yes">Yes</option><option value="No">No</option></select>
                        <div id="skillCar-error" class="validation-message"></div>
                    </div>
                    <div class="question-step hidden" data-step="16" data-segment="skillsLanguages">
                        <label for="skillLicense" class="block text-xl font-bold mb-3">Do you have a valid license?</label>
                        <select id="skillLicense" name="skillLicense" class="form-select" required><option value="" disabled selected>Select...</option><option value="Yes - 2 Wheeler">Yes - 2 Wheeler</option><option value="Yes - 4 Wheeler">Yes - 4 Wheeler</option><option value="Yes - Both">Yes - Both</option><option value="No">No</option></select>
                        <div id="skillLicense-error" class="validation-message"></div>
                    </div>
                    <div class="question-step hidden" data-step="17" data-segment="skillsLanguages">
                        <label class="block text-xl font-bold mb-3">Which languages do you know? (Optional)</label>
                        <div id="language-list" class="space-y-3"></div>
                        <button type="button" id="add-language-btn" class="btn btn-secondary mt-3 text-sm py-2">Add Language</button>
                    </div>

                    <!-- Segment 5: Aptitude Questionnaire -->
                    <div class="question-step hidden" data-step="18" data-segment="questionnaire">
                        <h2 class="text-xl font-bold mb-1">Aptitude Questionnaire (1/5)</h2>
                        <label id="situational-label-1" for="situationalAnswer1" class="block text-lg font-medium mb-3">Question 1</label>
                        <textarea id="situationalAnswer1" name="situationalAnswer1" class="form-textarea-small" rows="3" placeholder="Your answer..." required maxlength="250"></textarea>
                        <div id="situationalAnswer1-error" class="validation-message"></div>
                        <div id="situationalAnswer1-counter" class="text-xs text-slate-400 text-right mt-1">0 / 250</div>
                    </div>
                    <div class="question-step hidden" data-step="19" data-segment="questionnaire">
                        <h2 class="text-xl font-bold mb-1">Aptitude Questionnaire (2/5)</h2>
                        <label id="situational-label-2" for="situationalAnswer2" class="block text-lg font-medium mb-3">Question 2</label>
                        <textarea id="situationalAnswer2" name="situationalAnswer2" class="form-textarea-small" rows="3" placeholder="Your answer..." required maxlength="250"></textarea>
                        <div id="situationalAnswer2-error" class="validation-message"></div>
                        <div id="situationalAnswer2-counter" class="text-xs text-slate-400 text-right mt-1">0 / 250</div>
                    </div>
                    <div class="question-step hidden" data-step="20" data-segment="questionnaire">
                        <h2 class="text-xl font-bold mb-1">Aptitude Questionnaire (3/5)</h2>
                        <label id="situational-label-3" for="situationalAnswer3" class="block text-lg font-medium mb-3">Question 3</label>
                        <textarea id="situationalAnswer3" name="situationalAnswer3" class="form-textarea-small" rows="3" placeholder="Your answer..." required maxlength="250"></textarea>
                        <div id="situationalAnswer3-error" class="validation-message"></div>
                        <div id="situationalAnswer3-counter" class="text-xs text-slate-400 text-right mt-1">0 / 250</div>
                    </div>
                    <div class="question-step hidden" data-step="21" data-segment="questionnaire">
                        <h2 class="text-xl font-bold mb-1">Aptitude Questionnaire (4/5)</h2>
                        <label id="situational-label-4" for="situationalAnswer4" class="block text-lg font-medium mb-3">Question 4</label>
                        <textarea id="situationalAnswer4" name="situationalAnswer4" class="form-textarea-small" rows="3" placeholder="Your answer..." required maxlength="250"></textarea>
                        <div id="situationalAnswer4-error" class="validation-message"></div>
                        <div id="situationalAnswer4-counter" class="text-xs text-slate-400 text-right mt-1">0 / 250</div>
                    </div>
                    <div class="question-step hidden" data-step="22" data-segment="questionnaire">
                        <h2 class="text-xl font-bold mb-1">Aptitude Questionnaire (5/5)</h2>
                        <label id="situational-label-5" for="situationalAnswer5" class="block text-lg font-medium mb-3">Question 5</label>
                        <textarea id="situationalAnswer5" name="situationalAnswer5" class="form-textarea-small" rows="3" placeholder="Your answer..." required maxlength="250"></textarea>
                        <div id="situationalAnswer5-error" class="validation-message"></div>
                        <div id="situationalAnswer5-counter" class="text-xs text-slate-400 text-right mt-1">0 / 250</div>
                    </div>

                    <!-- Segment 6: Declarations & Reference -->
                    <div class="question-step hidden" data-step="23" data-segment="declarations">
                        <label for="criminalCase" class="block text-xl font-bold mb-3">Do you have any criminal cases?</label>
                        <select id="criminalCase" name="criminalCase" class="form-select" required><option value="" disabled selected>Select...</option><option value="No">No</option><option value="Yes">Yes</option></select>
                        <div id="criminalCase-error" class="validation-message"></div>
                    </div>
                    <div class="question-step hidden" data-step="24" data-segment="declarations">
                        <label for="residentialSupport" class="block text-xl font-bold mb-3">Will you need residential support?</label>
                        <select id="residentialSupport" name="residentialSupport" class="form-select" required><option value="" disabled selected>Select...</option><option value="No">No</option><option value="Yes">Yes</option></select>
                        <div id="residentialSupport-error" class="validation-message"></div>
                    </div>
                    <div class="question-step hidden" data-step="25" data-segment="declarations">
                        <label for="availability" class="block text-xl font-bold mb-3">How soon can you join, if selected?</label>
                        <select id="availability" name="availability" class="form-select" required><option value="" disabled selected>Select...</option><option value="Immediately">Immediately</option><option value="Within 15 Days">Within 15 Days</option><option value="Within 30 Days">Within 30 Days</option><option value="More than 30 Days">More than 30 Days</option></select>
                        <div id="availability-error" class="validation-message"></div>
                    </div>
                    <div class="question-step hidden" data-step="26" data-segment="declarations">
                        <label for="howDidYouHear" class="block text-xl font-bold mb-3">How did you hear about us?</label>
                        <select id="howDidYouHear" name="howDidYouHear" class="form-select" required><option value="" disabled selected>Select...</option><option value="Social Media (Instagram/Facebook)">Social Media (Instagram/Facebook)</option><option value="Job Portal (e.g., Naukri, Indeed)">Job Portal (e.g., Naukri, Indeed)</option><option value="Friend or Family">Friend or Family</option><option value="Clenzzo Website">Clenzzo Website</option><option value="Other">Other</option></select>
                        <div id="howDidYouHear-error" class="validation-message"></div>
                    </div>
                    <div class="question-step hidden" data-step="27" data-segment="declarations">
                        <label for="referenceName" class="block text-xl font-bold mb-3">Please provide one reference.</label>
                        <input type="text" id="referenceName" name="referenceName" class="form-input" placeholder="Reference Person's Name" required>
                        <div id="referenceName-error" class="validation-message"></div>
                    </div>
                    <div class="question-step hidden" data-step="28" data-segment="declarations">
                        <label for="referenceContact" class="block text-xl font-bold mb-3">What's your reference's contact number?</label>
                        <input type="tel" id="referenceContact" name="referenceContact" class="form-input" placeholder="Reference Person's Contact Number" required>
                        <div id="referenceContact-error" class="validation-message"></div>
                    </div>
                    <div class="question-step hidden" data-step="29" data-segment="declarations">
                        <label for="anythingElse" class="block text-xl font-bold mb-3">Anything else to add? (Optional)</label>
                        <textarea id="anythingElse" name="anythingElse" class="form-textarea" rows="4" placeholder="Optional: Tell us more..."></textarea>
                        <div id="anythingElse-error" class="validation-message"></div>
                    </div>
                </form>
            </div> <!-- End question-flow-wrapper -->

            <!-- Navigation Buttons -->
            <div class="mt-8 flex gap-4">
                <button id="prev-btn" class="btn btn-secondary w-1/2">Previous</button>
                <button id="next-btn" class="btn btn-primary w-1/2">Next</button>
            </div>
        </div>
        
        <!-- ===== PAGE 6: REVIEW ===== -->
        <div id="page-review" class="p-6 md:p-8 hidden">
            <h1 class="text-3xl font-bold text-white mb-6">Review Your Application</h1>
            <p class="text-slate-400 mb-6">One last look. If you need to make changes, click the 'Edit' button for that section.</p>
            <div id="review-content" class="space-y-6 text-slate-300"></div>
            <!-- *** MODIFIED: This is now a button, not a link *** -->
            <div class="mt-8 flex gap-4"><button id="review-back-btn" class="btn btn-secondary w-1/2">Back to Hub</button><button id="review-submit-btn" class="btn btn-primary w-1/2">Looks Good, Continue!</button></div>
        </div>

        <!-- ===== PAGE 7: LAST STEP (WAS SUCCESS) ===== -->
        <div id="page-last-step" class="p-6 md:p-8 hidden">
            <div class="text-center">
                <svg class="w-16 h-16 text-teal-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                <h1 id="last-step-greeting" class="text-3xl font-bold text-white mb-3">Last Step!</h1>
                <p class="text-slate-300 mb-6 text-lg">Please send your application details.</p>
                <p class="text-teal-400 font-bold text-xl p-4 bg-slate-900 rounded-lg border border-teal-800">
                    WhatsApp is recommended for all devices.
                </p>
                
                <div class="mt-6 space-y-4">
                    <a id="submit-whatsapp-link-btn" href="#" target="_blank" class="btn btn-primary" style="background-color: #25D366; hover:background-color: #128C7E;">
                        <span class="flex items-center justify-center gap-2">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12.04 2C6.58 2 2.13 6.45 2.13 11.91C2.13 13.66 2.59 15.36 3.45 16.86L2.06 22L7.32 20.6C8.77 21.41 10.37 21.82 12.04 21.82C17.5 21.82 21.95 17.37 21.95 11.91C21.95 6.45 17.5 2 12.04 2M12.04 3.67C16.59 3.67 20.28 7.36 20.28 11.91C20.28 16.46 16.59 20.15 12.04 20.15C10.53 20.15 9.09 19.79 7.8 19.12L7.32 18.88L4.8 19.65L5.58 17.21L5.34 16.73C4.6 15.4 4.21 13.7 4.21 11.91C4.21 7.36 7.9 3.67 12.04 3.67M9.22 7.26C9 7.26 8.8 7.26 8.61 7.26C8.42 7.26 8.22 7.26 8.02 7.32C7.83 7.38 7.63 7.44 7.44 7.56C7.25 7.68 7.07 7.83 6.91 8.02C6.75 8.21 6.6 8.41 6.48 8.63C6.36 8.85 6.27 9.09 6.19 9.35C6.12 9.61 6.06 9.88 6.04 10.16C6.03 10.44 6.03 10.73 6.03 11.03C6.03 11.33 6.03 11.63 6.04 11.93C6.06 12.23 6.1 12.51 6.16 12.78C6.22 13.05 6.3 13.3 6.41 13.55C6.51 13.8 6.63 14.04 6.78 14.27C6.93 14.5 7.1 14.71 7.3 14.9C7.5 15.09 7.71 15.26 7.95 15.4C8.19 15.54 8.44 15.66 8.7 15.76C8.96 15.86 9.22 15.93 9.49 15.98C9.76 16.03 10.03 16.06 10.31 16.06C10.59 16.06 10.87 16.05 11.14 16C11.41 15.95 11.67 15.87 11.92 15.77C12.17 15.67 12.41 15.54 12.63 15.39C12.85 15.24 13.06 15.07 13.24 14.87C13.42 14.67 13.58 14.46 13.71 14.22C13.84 13.98 13.95 13.73 14.04 13.46C14.13 13.19 14.19 12.91 14.24 12.62C14.29 12.33 14.31 12.04 14.3 11.73C14.29 11.42 14.26 11.11 14.21 10.79C14.16 10.47 14.08 10.16 13.98 9.85C13.88 9.54 13.76 9.25 13.62 8.97C13.48 8.69 13.31 8.42 13.13 8.17C12.95 7.92 12.75 7.7 12.53 7.5C12.31 7.3 12.07 7.13 11.82 7C11.57 6.87 11.31 6.77 11.04 6.69C10.77 6.61 10.49 6.56 10.2 6.53C9.91 6.5 9.61 6.5 9.3 6.5C9.28 6.5 9.26 6.5 9.24 6.5C8.96 6.5 8.68 6.5 8.41 6.5C8.14 6.5 7.87 6.53 7.6 6.59C7.33 6.65 7.07 6.73 6.82 6.85C6.57 6.97 6.33 7.12 6.1 7.29C5.87 7.46 5.66 7.66 5.47 7.88C5.28 8.1 5.11 8.34 4.97 8.6C4.83 8.86 4.71 9.13 4.62 9.42C4.53 9.71 4.47 10 4.44 10.3C4.41 10.6 4.41 10.91 4.41 11.22C4.41 11.53 4.41 11.85 4.44 12.16C4.47 12.47 4.53 12.78 4.62 13.08C4.71 13.38 4.83 13.67 4.97 13.95C5.11 14.23 5.28 14.5 5.47 14.75C5.66 15 5.87 15.22 6.1 15.41C6.33 15.6 6.57 15.76 6.82 15.9C7.07 16.04 7.33 16.15 7.6 16.23C7.87 16.31 8.14 16.36 8.41 16.39C8.68 16.42 8.96 16.42 9.24 16.42C9.52 16.42 9.79 16.42 10.06 16.39C10.33 16.36 10.6 16.3 10.86 16.21C11.12 16.12 11.37 16 11.6 15.86C11.83 15.72 12.05 15.56 12.25 15.37C12.45 15.18 12.63 14.97 12.79 14.74C12.95 14.51 13.08 14.26 13.19 14C13.3 13.74 13.38 13.47 13.44 13.19C13.5 12.91 13.54 12.63 13.56 12.34C13.58 12.05 13.58 11.75 13.58 11.45C13.58 11.15 13.58 10.84 13.56 10.54C13.54 10.24 13.5 9.95 13.44 9.67C13.38 9.39 13.3 9.12 13.19 8.86C13.08 8.6 12.95 8.35 12.79 8.12C12.63 7.89 12.45 7.68 12.25 7.49C12.05 7.3 11.83 7.14 11.6 7C11.37 6.86 11.12 6.76 10.86 6.68C10.6 6.6 10.33 6.55 10.06 6.52C9.79 6.49 9.52 6.49 9.24 6.49C9.24 6.49 9.23 6.49 9.22 7.26Z"></path></svg>
                            Submit via WhatsApp
                        </span>
                    </a>
                    <a id="resend-email-link-btn" href="#" class="btn btn-secondary">Submit via Email (Fallback)</a>
                </div>

                <div class="mt-8 p-4 bg-slate-900 rounded-lg border border-slate-700 text-left">
                    <p class="text-slate-300 text-sm">If you are on a desktop, clicking WhatsApp will open WhatsApp Web. If you don't have it set up, please use your mobile phone to complete the application.</p>
                </div>
            </div>
        </div>

        <!-- ===== PAGE 8: THANK YOU (NEW) ===== -->
        <div id="page-thank-you" class="p-6 md:p-8 hidden">
            <div class="text-center">
                <svg class="w-16 h-16 text-teal-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                <h1 id="thank-you-greeting" class="text-3xl font-bold text-white mb-3">Thank You!</h1>
                <p class="text-slate-300 mb-6 text-lg">
                    Your application has been sent.
                </p>
                <div class="mt-8 p-4 bg-slate-900 rounded-lg border border-slate-700 text-left">
                    <h3 class="font-bold text-white text-lg mb-2">What's Next?</h3>
                    <p class="text-slate-300 text-sm">Our team will review your application. If your profile matches our needs, we will contact you within <strong>5 business days</strong> to schedule an interview.</p>
                </div>
            </div>
        </div>

        <!-- ===== BRANDING FOOTER ===== -->
        <footer class="p-4 text-center text-xs text-slate-500 border-t border-slate-700">
            ¬© <span id="current-year"></span> Clenzzo. All rights reserved.
            <a href="https://clenzzo.com" target="_blank" rel="noopener noreferrer" class="ml-2 hover:text-teal-400">clenzzo.com</a>
        </footer>
    </div>

    <!-- ===== JAVASCRIPT ===== -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- STATE & ELEMENTS ---
            let currentSegmentId = null;
            let currentSegmentQuestions = [];
            let currentSegmentQuestionIndex = 0;
            let firstName = '';
            
            const pages = {
                header: document.getElementById('app-header'),
                welcome: document.getElementById('page-welcome'),
                disclaimer: document.getElementById('page-disclaimer'),
                nameCapture: document.getElementById('page-name-capture'),
                segmentHub: document.getElementById('page-segment-hub'),
                questionFlow: document.getElementById('page-question-flow'),
                review: document.getElementById('page-review'),
                lastStep: document.getElementById('page-last-step'), // Renamed
                thankYou: document.getElementById('page-thank-you')  // New
            };
            
            const formWrapper = document.getElementById('question-flow-wrapper');
            const allFormSteps = Array.from(document.querySelectorAll('.question-step'));
            
            const progressBar = {
                overall: document.getElementById('overall-progress-bar'),
                overallText: document.getElementById('overall-progress-text'),
                segment: document.getElementById('segment-progress-bar'),
                segmentText: document.getElementById('segment-progress-label')
            };
            
            const navButtons = {
                next: document.getElementById('next-btn'),
                prev: document.getElementById('prev-btn')
            };
            
            const positionSelect = document.getElementById('position');
            const positionDetails = document.getElementById('position-details');

            // --- SEGMENT DEFINITIONS ---
            const segmentDefinitions = {
                basicInfo: { title: 'üë§ Basic Info', questions: allFormSteps.filter(s => s.dataset.segment === 'basicInfo') },
                roleMotivation: { title: 'üéØ Role & Motivation', questions: allFormSteps.filter(s => s.dataset.segment === 'roleMotivation') },
                eduExperience: { title: 'üéì Education & Experience', questions: allFormSteps.filter(s => s.dataset.segment === 'eduExperience') },
                skillsLanguages: { title: 'üîß Skills & Languages', questions: allFormSteps.filter(s => s.dataset.segment === 'skillsLanguages') },
                questionnaire: { title: 'üß† Aptitude Questionnaire', questions: allFormSteps.filter(s => s.dataset.segment === 'questionnaire') },
                declarations: { title: 'üìù Declarations & Reference', questions: allFormSteps.filter(s => s.dataset.segment === 'declarations') }
            };

            let segmentStatus = {
                basicInfo: 'todo',
                roleMotivation: 'todo',
                eduExperience: 'todo',
                skillsLanguages: 'todo',
                questionnaire: 'todo',
                declarations: 'todo'
            };
            
            let formData = {};
            
            // --- DATA MAPS ---
            const positionQualifications = {
                "Supervising Officer": "Seeking natural leaders. Freshers with strong team leadership skills (e.g., college, sports) are welcome.",
                "Detailer": "We need meticulous, hands-on individuals with high attention to detail. Full training provided ‚Äì freshers welcome.",
                "Admin Executive": "Seeking organized, reliable individuals. Familiarity with basic computer skills (Excel, Email) is a plus. Freshers welcome.",
                "Sales Executive": "Seeking confident, persuasive communicators with a target-driven mindset. Freshers welcome.",
                "Marketing Executive": "Seeking creative, tech-savvy individuals passionate about social media and building a brand. Freshers welcome."
            };

            const situationalQuestionSets = {
                "Detailer": [ "A customer claims you missed a spot. You checked, and you don't think you did. How do you handle this?", "It's 5:30 AM, and you feel unwell. Your first job is at 6:00 AM. What are your exact steps?", "You are running 10 minutes late for a job. What do you do?", "How would you rank these in order of importance for this job: Speed, Quality, Friendliness.", "What's one quality a great detailer must have?" ],
                "Supervising Officer": [ "A customer is unhappy with a detailer's work. What is your first action?", "A detailer on your team is consistently 10 minutes late. How do you handle it?", "You accidentally splash a little cleaning solution on a client's leather seat. What is your *immediate* next action?", "How do you motivate a team member who seems tired or unmotivated?", "What's the most important quality a team leader must have?" ],
                "Admin Executive": [ "You have two urgent reports due and a team member is asking for help. How do you prioritize?", "You find a mistake in a financial report *after* you've already sent it to your manager. What do you do?", "A customer calls with an angry complaint, and your manager is not available. What do you do?", "What's a simple trick you use to keep your work organized (e.g., a to-do list, a calendar)?", "How comfortable are you with learning new software or apps on a scale of 1 (Not) to 5 (Very)?" ],
                "Sales Executive": [ "A client says, 'Your price is way too high.' What is your first sentence in response?", "You've had no new leads for 3 days. What's the first thing you do to change that?", "How do you handle hearing 'No' 10 times in a row?", "A client is almost ready to sign but wants a discount you are not allowed to give. How do you save the deal?", "What's more important for long-term sales: A clever pitch or building trust?" ],
                "Marketing Executive": [ "You have a ‚Çπ1000 budget to get 5 new customers in a single neighborhood. What's your idea?", "A negative comment is posted on one of our social media ads. What do you do?", "How would you describe 'waterless car cleaning' in one sentence for an Instagram ad?", "What's a brand (any brand) that you think does marketing well, and why?", "Our website traffic is down 20%. Where would you *start* looking for the problem?" ],
                "default": [ "Tell us about a time you solved a difficult problem at work or school.", "What's a quality you have that makes you a great team member?", "How do you handle a situation where you have too many tasks and not enough time?", "What is your definition of 'good customer service'?", "Why do you think you are a good fit for a startup environment?" ]
            };
            
            // --- VALIDATION RULES ---
            const validationRules = {
                'fullName': { required: true, textOnly: true, message: 'Please enter a valid name (text only).' },
                'fullName-q': { required: true, textOnly: true, message: 'Please enter a valid name (text only).' },
                'email': { required: true, email: true, message: 'Please enter a valid email address.' },
                'phone': { required: true, phone: true, message: 'Please enter a valid 10-digit phone number.' },
                'maritalStatus': { required: true, message: 'Please select an option.' },
                'placeOfBirth': { required: true, textOnly: true, message: 'Please enter a valid place name.' },
                'currentAddress': { required: true, message: 'This field is required.' },
                'position': { required: true, message: 'Please select a position.' },
                'salary': { required: true, message: 'Please select a salary range.' },
                'whyClenzzo': { required: true, message: 'This field is required.' },
                'qualification': { required: true, message: 'This field is required.' },
                'educationPlace': { required: true, message: 'This field is required.' },
                'hasExperience': { required: true, message: 'Please select an option.' },
                'skillMotorcycle': { required: true, message: 'Please select an option.' },
                'skillCar': { required: true, message: 'Please select an option.' },
                'skillLicense': { required: true, message: 'Please select an option.' },
                'criminalCase': { required: true, message: 'Please select an option.' },
                'residentialSupport': { required: true, message: 'Please select an option.' },
                'availability': { required: true, message: 'Please select an option.' },
                'howDidYouHear': { required: true, message: 'Please select an option.' },
                'situationalAnswer1': { required: true, message: 'This field is required.' },
                'situationalAnswer2': { required: true, message: 'This field is required.' },
                'situationalAnswer3': { required: true, message: 'This field is required.' },
                'situationalAnswer4': { required: true, message: 'This field is required.' },
                'situationalAnswer5': { required: true, message: 'This field is required.' },
                'referenceName': { required: true, textOnly: true, message: 'Please enter a valid name.' },
                'referenceContact': { required: true, phone: true, message: 'Please enter a valid 10-digit phone number.' },
                'exp-company': { required: true, message: 'Company name is required.' },
                'exp-role': { required: true, message: 'Role is required.' },
                'exp-duration': { required: true, message: 'Duration is required.' },
                'lang-name': { required: true, message: 'Language name is required.' }
            };

            // --- VALIDATION ENGINE ---
            function validateField(inputEl) {
                if (!inputEl) return true;
                const ruleKey = inputEl.dataset.ruleKey || inputEl.id;
                const rules = validationRules[ruleKey];
                if (!rules) return true; 

                const errorEl = document.getElementById(inputEl.id + '-error');
                const value = inputEl.value.trim();
                let isValid = true;
                let errorMessage = '';

                if (rules.required && value === '') {
                    isValid = false;
                    errorMessage = rules.message;
                } else if (rules.email && value.length > 0 && !/^\S+@\S+\.\S+$/.test(value)) {
                    isValid = false;
                    errorMessage = rules.message;
                } else if (rules.phone && value.length > 0 && !/^\d{10}$/.test(value)) {
                    isValid = false;
                    errorMessage = rules.message;
                } else if (rules.textOnly && value.length > 0 && !/^[a-zA-Z\s.-]+$/.test(value)) {
                    isValid = false;
                    errorMessage = rules.message;
                }

                if (!isValid) {
                    inputEl.classList.add('is-invalid');
                    if(errorEl) errorEl.textContent = errorMessage;
                } else {
                    inputEl.classList.remove('is-invalid');
                    if(errorEl) errorEl.textContent = '';
                }
                return isValid;
            }

            function setupValidationListeners() {
                Object.keys(validationRules).forEach(id => {
                    const inputEl = document.getElementById(id);
                    if (inputEl) {
                        const eventType = inputEl.tagName === 'SELECT' ? 'change' : 'blur';
                        inputEl.addEventListener(eventType, () => validateField(inputEl));
                    }
                });
            }

            function setupDynamicValidation(container) {
                container.querySelectorAll('input, select, textarea').forEach(inputEl => {
                    const eventType = inputEl.tagName === 'SELECT' ? 'change' : 'blur';
                    inputEl.addEventListener(eventType, () => validateField(inputEl));
                });
            }

            // --- NAVIGATION ---
            function navigateTo(pageKey) {
                Object.values(pages).forEach(page => page.classList.add('hidden'));
                if (pages[pageKey]) pages[pageKey].classList.remove('hidden');
                pages.header.classList.toggle('hidden', pageKey === 'welcome');
                document.getElementById('app-container').scrollIntoView();
            }

            window.jumpToSegment = (segId, questionStep) => {
                startSegment(segId);
                const questionIndex = segmentDefinitions[segId].questions.findIndex(q => q.dataset.step == questionStep);
                if (questionIndex !== -1) {
                    currentSegmentQuestions[0].classList.add('hidden');
                    showSegmentQuestion(questionIndex, true);
                }
            }
            
            // --- SEGMENT HUB LOGIC ---
            function updateSegmentHub() {
                const segmentList = document.getElementById('segment-list');
                segmentList.innerHTML = '';
                let completedCount = 0;
                
                Object.keys(segmentDefinitions).forEach(segId => {
                    const segment = segmentDefinitions[segId];
                    const status = segmentStatus[segId];
                    let statusText = '', statusIcon = '', cardClass = '';
                    
                    if (status === 'complete') {
                        statusText = 'Complete'; statusIcon = '‚úÖ'; cardClass = 'segment-card-complete'; completedCount++;
                    } else if (status === 'in-progress') {
                        statusText = 'In Progress'; statusIcon = '‚úèÔ∏è'; cardClass = 'segment-card-inprogress';
                    } else {
                        statusText = 'Not Started'; statusIcon = 'üìÑ'; cardClass = 'segment-card-todo';
                    }

                    const cardHTML = `
                        <div id="segment-btn-${segId}" class="segment-card ${cardClass}" data-segment-id="${segId}">
                            <div class="flex items-center gap-4">
                                <span class="text-2xl">${segment.title[0]}</span>
                                <div>
                                    <h3 class="font-bold text-white text-lg">${segment.title.substring(2)}</h3>
                                    <p class="text-sm text-slate-400">${statusText}</p>
                                </div>
                            </div>
                            <span class="text-xl">${statusIcon}</span>
                        </div>`;
                    segmentList.insertAdjacentHTML('beforeend', cardHTML);
                    document.getElementById(`segment-btn-${segId}`).addEventListener('click', () => startSegment(segId));
                });

                const totalSegments = Object.keys(segmentDefinitions).length;
                progressBar.overall.style.width = `${(completedCount / totalSegments) * 100}%`;
                progressBar.overallText.textContent = `${completedCount}/${totalSegments} Segments`;

                const submitBtn = document.getElementById('hub-submit-btn');
                submitBtn.disabled = (completedCount !== totalSegments);
                submitBtn.classList.toggle('btn-disabled', submitBtn.disabled);
                submitBtn.classList.toggle('btn-primary', !submitBtn.disabled);
            }
            
            // --- QUESTION FLOW LOGIC ---
            function startSegment(segId) {
                currentSegmentId = segId;
                currentSegmentQuestions = segmentDefinitions[segId].questions;
                currentSegmentQuestionIndex = 0;

                if (segmentStatus[segId] === 'todo') {
                    segmentStatus[segId] = 'in-progress';
                }

                document.getElementById('question-flow-title').textContent = segmentDefinitions[segId].title.substring(2);
                allFormSteps.forEach(step => step.classList.add('hidden'));
                showSegmentQuestion(0, true);
                navigateTo('questionFlow');
                updateSegmentProgress();
                saveProgress();
            }

            function showSegmentQuestion(index, isInstant = false) {
                const stepToHide = currentSegmentQuestions[currentSegmentQuestionIndex];
                const stepToShow = currentSegmentQuestions[index];

                if (!stepToShow) {
                    console.error("Attempted to show a question that doesn't exist.");
                    navigateTo('segmentHub');
                    return;
                }
                
                if (firstName) {
                    const greeting = document.getElementById('personal-greeting');
                    greeting.textContent = `Alright, ${firstName}...`;
                    greeting.classList.remove('hidden');
                }
                
                if (currentSegmentId === 'questionnaire') {
                    const position = formData.position || 'default';
                    const questionSet = situationalQuestionSets[position] || situationalQuestionSets["default"];
                    if (!formData.questionSet) formData.questionSet = questionSet;
                    
                    document.getElementById(`situational-label-1`).textContent = formData.questionSet[0];
                    document.getElementById(`situational-label-2`).textContent = formData.questionSet[1];
                    document.getElementById(`situational-label-3`).textContent = formData.questionSet[2];
                    document.getElementById(`situational-label-4`).textContent = formData.questionSet[3];
                    document.getElementById(`situational-label-5`).textContent = formData.questionSet[4];
                }

                formWrapper.style.minHeight = `${stepToShow.offsetHeight + 60}px`;
                
                if (isInstant) {
                    if (stepToHide) stepToHide.classList.add('hidden');
                    stepToShow.classList.remove('hidden');
                    stepToShow.classList.add('fade-in');
                } else {
                    stepToHide.classList.add('fade-out');
                    setTimeout(() => {
                        stepToHide.classList.add('hidden');
                        stepToHide.classList.remove('fade-out');
                        stepToShow.classList.remove('hidden');
                        void stepToShow.offsetWidth;
                        stepToShow.classList.add('fade-in');
                        formWrapper.style.minHeight = `${stepToShow.offsetHeight + 60}px`;
                    }, 300);
                }
                
                if (stepToShow.dataset.step === "17" && document.getElementById('language-list').children.length === 0) {
                    addLanguageField();
                }
                
                currentSegmentQuestionIndex = index;
                updateSegmentProgress();
            }
            
            function updateSegmentProgress() {
                const total = currentSegmentQuestions.length;
                const current = currentSegmentQuestionIndex + 1;
                progressBar.segment.style.width = `${(current / total) * 100}%`;
                progressBar.segmentText.textContent = `Step ${current} of ${total}`;
                navButtons.prev.classList.toggle('hidden', currentSegmentQuestionIndex === 0);
                navButtons.next.textContent = (currentSegmentQuestionIndex === total - 1) ? 'Segment Complete' : 'Next';
            }
            
            function validateCurrentSegmentStep() {
                const currentStepElement = currentSegmentQuestions[currentSegmentQuestionIndex];
                const inputs = currentStepElement.querySelectorAll('input, select, textarea');
                let isStepValid = true;
                
                inputs.forEach(input => {
                    if (input.offsetWidth > 0) {
                        const isValid = validateField(input);
                        if (!isValid) isStepValid = false;
                    }
                });
                return isStepValid;
            }

            // --- DYNAMIC FIELD FUNCTIONS (with validation listeners) ---
            function addLanguageField(lang = { name: '', read: false, write: false, speak: false }) {
                const list = document.getElementById('language-list');
                const langIndex = list.children.length;
                const langFieldHTML = `
                    <div class="language-item bg-slate-900 p-3 rounded-lg border border-slate-700">
                        <input type="text" id="lang-name-${langIndex}" data-rule-key="lang-name" class="form-input mb-2" placeholder="Language (e.g., Tamil)" value="${lang.name}" required>
                        <div id="lang-name-${langIndex}-error" class="validation-message"></div>
                        <div class="flex flex-wrap gap-4 text-sm mt-2">
                            <label class="flex items-center"><input type="checkbox" data-lang-read="${langIndex}" ${lang.read ? 'checked' : ''} class="h-4 w-4 bg-slate-700 text-teal-500 focus:ring-teal-500 rounded"> <span class="ml-2">Read</span></label>
                            <label class="flex items-center"><input type="checkbox" data-lang-write="${langIndex}" ${lang.write ? 'checked' : ''} class="h-4 w-4 bg-slate-700 text-teal-500 focus:ring-teal-500 rounded"> <span class="ml-2">Write</span></label>
                            <label class="flex items-center"><input type="checkbox" data-lang-speak="${langIndex}" ${lang.speak ? 'checked' : ''} class="h-4 w-4 bg-slate-700 text-teal-500 focus:ring-teal-500 rounded"> <span class="ml-2">Speak</span></label>
                        </div>
                    </div>`;
                list.insertAdjacentHTML('beforeend', langFieldHTML);
                setupDynamicValidation(list.lastChild);
                formWrapper.style.minHeight = `${currentSegmentQuestions[currentSegmentQuestionIndex].offsetHeight + list.offsetHeight + 100}px`;
            }
            
            function addExperienceField(exp = { company: '', role: '', duration: '' }) {
                const container = document.getElementById('experience-container');
                const expIndex = container.children.length;
                const expFieldHTML = `
                    <div class="experience-item bg-slate-900 p-3 rounded-lg border border-slate-700 space-y-2">
                        <div>
                            <input type="text" id="exp-company-${expIndex}" data-rule-key="exp-company" class="form-input" placeholder="Company Name" value="${exp.company}" required>
                            <div id="exp-company-${expIndex}-error" class="validation-message"></div>
                        </div>
                        <div>
                            <input type="text" id="exp-role-${expIndex}" data-rule-key="exp-role" class="form-input" placeholder="Your Role" value="${exp.role}" required>
                            <div id="exp-role-${expIndex}-error" class="validation-message"></div>
                        </div>
                        <div>
                            <input type="text" id="exp-duration-${expIndex}" data-rule-key="exp-duration" class="form-input" placeholder="Duration (e.g., 2 Years)" value="${exp.duration}" required>
                            <div id="exp-duration-${expIndex}-error" class="validation-message"></div>
                        </div>
                    </div>`;
                container.insertAdjacentHTML('beforeend', expFieldHTML);
                setupDynamicValidation(container.lastChild);
                formWrapper.style.minHeight = `${currentSegmentQuestions[currentSegmentQuestionIndex].offsetHeight + container.offsetHeight + 100}px`;
            }

            // --- EVENT LISTENERS (Navigation) ---
            document.getElementById('start-btn').addEventListener('click', () => navigateTo('disclaimer'));

            document.getElementById('agree-checkbox').addEventListener('change', (e) => {
                const continueBtn = document.getElementById('disclaimer-continue-btn');
                continueBtn.disabled = !e.target.checked;
                continueBtn.classList.toggle('btn-disabled', !e.target.checked);
                continueBtn.classList.toggle('btn-primary', e.target.checked);
                saveProgress();
            });

            document.getElementById('disclaimer-continue-btn').addEventListener('click', (e) => {
                if (e.target.disabled) return;
                navigateTo('nameCapture');
            });
            
            document.getElementById('name-continue-btn').addEventListener('click', () => {
                const nameInput = document.getElementById('fullName');
                if (validateField(nameInput)) {
                    firstName = nameInput.value.trim().split(' ')[0];
                    formData.fullName = nameInput.value.trim();
                    document.getElementById('fullName-q').value = nameInput.value.trim();
                    segmentStatus.basicInfo = 'in-progress';
                    document.getElementById('hub-greeting').textContent = `Welcome, ${firstName}!`;
                    saveProgress();
                    updateSegmentHub();
                    navigateTo('segmentHub');
                }
            });

            document.getElementById('hub-submit-btn').addEventListener('click', (e) => {
                if (e.target.disabled) return;
                buildReviewPage();
                navigateTo('review');
            });
            
            document.getElementById('question-flow-back-btn').addEventListener('click', () => {
                updateSegmentHub();
                navigateTo('segmentHub');
            });
            
            document.getElementById('review-back-btn').addEventListener('click', () => {
                updateSegmentHub();
                navigateTo('segmentHub');
            });

            navButtons.next.addEventListener('click', () => {
                if (validateCurrentSegmentStep()) {
                    gatherFormData();
                    
                    if (currentSegmentQuestions[currentSegmentQuestionIndex].dataset.step === "12" && formData.hasExperience === 'No') {
                        segmentStatus[currentSegmentId] = 'complete';
                        saveProgress();
                        updateSegmentHub();
                        navigateTo('segmentHub');
                        return; 
                    }
                    
                    if (currentSegmentQuestions[currentSegmentQuestionIndex].dataset.step === "12" && formData.hasExperience === 'Yes') {
                        if(document.getElementById('experience-container').children.length === 0) {
                            addExperienceField();
                        }
                    }

                    if (currentSegmentQuestionIndex === currentSegmentQuestions.length - 1) {
                        segmentStatus[currentSegmentId] = 'complete';
                        saveProgress();
                        updateSegmentHub();
                        navigateTo('segmentHub');
                    } else {
                        showSegmentQuestion(currentSegmentQuestionIndex, false);
                        currentSegmentQuestionIndex++;
                        showSegmentQuestion(currentSegmentQuestionIndex, false);
                        saveProgress();
                    }
                }
            });
            
            navButtons.prev.addEventListener('click', () => {
                if (currentSegmentQuestionIndex > 0) {
                    
                    if (currentSegmentQuestions[currentSegmentQuestionIndex].dataset.step === "14" && formData.hasExperience === 'No') {
                        showSegmentQuestion(currentSegmentQuestionIndex, false);
                        currentSegmentQuestionIndex = currentSegmentQuestions.findIndex(q => q.dataset.step === "12");
                        showSegmentQuestion(currentSegmentQuestionIndex, false);
                        saveProgress();
                        return;
                    }
                    
                    showSegmentQuestion(currentSegmentQuestionIndex, false);
                    currentSegmentQuestionIndex--;
                    showSegmentQuestion(currentSegmentQuestionIndex, false);
                    saveProgress();
                }
            });
            
            document.getElementById('add-language-btn').addEventListener('click', () => addLanguageField());
            document.getElementById('add-experience-btn').addEventListener('click', () => addExperienceField());
            
            // --- *** NEW SUBMISSION FLOW *** ---
            
            // 1. Review page button
            document.getElementById('review-submit-btn').addEventListener('click', (e) => {
                buildSubmissionPage(); // Generate the links
                navigateTo('lastStep');
            });

            // 2. WhatsApp button
            document.getElementById('submit-whatsapp-link-btn').addEventListener('click', () => {
                clearProgress();
                setTimeout(() => navigateTo('thankYou'), 300); // Navigate after link is opened
            });
            
            // 3. Email button
            document.getElementById('resend-email-link-btn').addEventListener('click', () => {
                clearProgress();
                setTimeout(() => navigateTo('thankYou'), 300); // Navigate after link is opened
            });

            // --- DATA GATHERING, REVIEW, MAILTO, WHATSAPP ---
            
            function gatherFormData() {
                const getValue = (id) => document.getElementById(id)?.value?.trim() || '';
                
                formData.fullName = getValue('fullName-q') || getValue('fullName');
                formData.email = getValue('email');
                formData.phone = getValue('phone');
                formData.position = getValue('position');
                formData.whyClenzzo = getValue('whyClenzzo');
                formData.salary = getValue('salary');
                formData.maritalStatus = getValue('maritalStatus');
                formData.placeOfBirth = getValue('placeOfBirth');
                formData.currentAddress = getValue('currentAddress');
                formData.qualification = getValue('qualification');
                formData.discipline = getValue('discipline');
                formData.educationPlace = getValue('educationPlace');
                formData.hasExperience = getValue('hasExperience');
                formData.skillMotorcycle = getValue('skillMotorcycle');
                formData.skillCar = getValue('skillCar');
                formData.skillLicense = getValue('skillLicense');
                formData.criminalCase = getValue('criminalCase');
                formData.residentialSupport = getValue('residentialSupport');
                formData.availability = getValue('availability');
                formData.howDidYouHear = getValue('howDidYouHear');
                formData.situationalAnswer1 = getValue('situationalAnswer1');
                formData.situationalAnswer2 = getValue('situationalAnswer2');
                formData.situationalAnswer3 = getValue('situationalAnswer3');
                formData.situationalAnswer4 = getValue('situationalAnswer4');
                formData.situationalAnswer5 = getValue('situationalAnswer5');
                formData.referenceName = getValue('referenceName');
                formData.referenceContact = getValue('referenceContact');
                formData.anythingElse = getValue('anythingElse');

                formData.languages = [];
                document.querySelectorAll('.language-item').forEach((item, index) => {
                    const name = item.querySelector(`[data-rule-key="lang-name"]`)?.value?.trim();
                    if (name) {
                        formData.languages.push({
                            name: name,
                            read: item.querySelector(`[data-lang-read="${index}"]`).checked,
                            write: item.querySelector(`[data-lang-write="${index}"]`).checked,
                            speak: item.querySelector(`[data-lang-speak="${index}"]`).checked,
                        });
                    }
                });
                
                formData.experience = [];
                if (formData.hasExperience === 'Yes') {
                    document.querySelectorAll('.experience-item').forEach((item, index) => {
                        formData.experience.push({
                            company: item.querySelector(`[data-rule-key="exp-company"]`)?.value?.trim(),
                            role: item.querySelector(`[data-rule-key="exp-role"]`)?.value?.trim(),
                            duration: item.querySelector(`[data-rule-key="exp-duration"]`)?.value?.trim(),
                        });
                    });
                }
            }

            function buildReviewPage() {
                gatherFormData();
                const reviewContent = document.getElementById('review-content');
                const formatLangSkills = (lang) => {
                    const skills = [];
                    if (lang.read) skills.push('Read');
                    if (lang.write) skills.push('Write');
                    if (lang.speak) skills.push('Speak');
                    return skills.length ? skills.join(', ') : 'N/A';
                };
                const langHtml = formData.languages.map(lang => `
                    <li class="ml-4"><strong>${lang.name}:</strong> ${formatLangSkills(lang)}</li>`).join('');
                const expHtml = formData.experience.map(exp => `
                    <li class="ml-4"><strong>${exp.role}</strong> at ${exp.company} (${exp.duration})</li>`).join('');
                const optional = (val) => val ? val.replace(/\n/g, '<br>') : '<span class="text-slate-500">N/A</span>';

                reviewContent.innerHTML = `
                    <div class="review-section bg-slate-900 p-4 rounded-lg border border-slate-700">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="text-xl font-bold text-teal-400">Basic Info</h3>
                            <button onclick="jumpToSegment('basicInfo', 0)" class="text-sm text-teal-400 hover:text-teal-300 font-medium py-1 px-2 rounded hover:bg-slate-700">Edit</button>
                        </div>
                        <p><strong>Name:</strong> ${formData.fullName}</p>
                        <p><strong>Email:</strong> ${formData.email}</p>
                        <p><strong>Phone:</strong> ${formData.phone}</p>
                        <p><strong>Marital Status:</strong> ${formData.maritalStatus}</p>
                        <p><strong>Place of Birth:</strong> ${formData.placeOfBirth}</p>
                        <p><strong>Address:</strong><br><span class="pl-2">${formData.currentAddress.replace(/\n/g, '<br>')}</span></p>
                    </div>
                    
                    <div class="review-section bg-slate-900 p-4 rounded-lg border border-slate-700">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="text-xl font-bold text-teal-400">Role & Motivation</h3>
                            <button onclick="jumpToSegment('roleMotivation', 6)" class="text-sm text-teal-400 hover:text-teal-300 font-medium py-1 px-2 rounded hover:bg-slate-700">Edit</button>
                        </div>
                        <p><strong>Applying for:</strong> ${formData.position}</p>
                        <p><strong>Salary Expectation:</strong> ${formData.salary}</p>
                        <p><strong>Why Clenzzo:</strong><br><span class="pl-2">${optional(formData.whyClenzzo)}</span></p>
                    </div>
                    
                    <div class="review-section bg-slate-900 p-4 rounded-lg border border-slate-700">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="text-xl font-bold text-teal-400">Aptitude Questionnaire</h3>
                            <button onclick="jumpToSegment('questionnaire', 18)" class="text-sm text-teal-400 hover:text-teal-300 font-medium py-1 px-2 rounded hover:bg-slate-700">Edit</button>
                        </div>
                        <div class="space-y-2 text-sm">
                            <p><strong>Q1:</strong> ${formData.questionSet[0]}<br><span class="pl-2 text-slate-300"><strong>A:</strong> ${optional(formData.situationalAnswer1)}</span></p>
                            <p><strong>Q2:</strong> ${formData.questionSet[1]}<br><span class="pl-2 text-slate-300"><strong>A:</strong> ${optional(formData.situationalAnswer2)}</span></p>
                            <p><strong>Q3:</strong> ${formData.questionSet[2]}<br><span class="pl-2 text-slate-300"><strong>A:</strong> ${optional(formData.situationalAnswer3)}</span></p>
                            <p><strong>Q4:</strong> ${formData.questionSet[3]}<br><span class="pl-2 text-slate-300"><strong>A:</strong> ${optional(formData.situationalAnswer4)}</span></p>
                            <p><strong>Q5:</strong> ${formData.questionSet[4]}<br><span class="pl-2 text-slate-300"><strong>A:</strong> ${optional(formData.situationalAnswer5)}</span></p>
                        </div>
                    </div>
                    
                    <div class="review-section bg-slate-900 p-4 rounded-lg border border-slate-700">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="text-xl font-bold text-teal-400">Education & Experience</h3>
                            <button onclick="jumpToSegment('eduExperience', 9)" class="text-sm text-teal-400 hover:text-teal-300 font-medium py-1 px-2 rounded hover:bg-slate-700">Edit</button>
                        </div>
                        <p><strong>Qualification:</strong> ${formData.qualification}</p>
                        <p><strong>Discipline:</strong> ${optional(formData.discipline)}</p>
                        <p><strong>Education Place:</strong> ${formData.educationPlace}</p>
                        <p class="mt-2"><strong>Experience:</strong> ${formData.hasExperience}</p>
                        <ul class="list-disc">${expHtml || ''}</ul>
                    </div>
                    
                    <div class="review-section bg-slate-900 p-4 rounded-lg border border-slate-700">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="text-xl font-bold text-teal-400">Skills & Languages</h3>
                            <button onclick="jumpToSegment('skillsLanguages', 14)" class="text-sm text-teal-400 hover:text-teal-300 font-medium py-1 px-2 rounded hover:bg-slate-700">Edit</button>
                        </div>
                        <p><strong>Ride Motorcycle:</strong> ${formData.skillMotorcycle}</p>
                        <p><strong>Drive Car:</strong> ${formData.skillCar}</p>
                        <p><strong>License:</strong> ${formData.skillLicense}</p>
                        <p><strong>Languages:</strong></p>
                        <ul class="list-disc">${langHtml || '<span class="text-slate-500 ml-4">No languages listed.</span>'}</ul>
                    </div>
                    
                    <div class="review-section bg-slate-900 p-4 rounded-lg border border-slate-700">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="text-xl font-bold text-teal-400">Declarations & Reference</h3>
                            <button onclick="jumpToSegment('declarations', 23)" class="text-sm text-teal-400 hover:text-teal-300 font-medium py-1 px-2 rounded hover:bg-slate-700">Edit</button>
                        </div>
                        <p><strong>Availability:</strong> ${formData.availability}</p>
                        <p><strong>Criminal Cases:</strong> ${formData.criminalCase}</p>
                        <p><strong>Needs Residential Support:</strong> ${formData.residentialSupport}</p>
                        <p><strong>Heard About Us Via:</strong> ${formData.howDidYouHear}</p>
                        <p><strong>Reference:</strong> ${formData.referenceName} (${formData.referenceContact})</p>
                    </div>
                    
                    <div class="review-section bg-slate-900 p-4 rounded-lg border border-slate-700">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="text-xl font-bold text-teal-400">Additional Notes</h3>
                            <button onclick="jumpToSegment('declarations', 29)" class="text-sm text-teal-400 hover:text-teal-300 font-medium py-1 px-2 rounded hover:bg-slate-700">Edit</button>
                        </div>
                        <p>${optional(formData.anythingElse)}</p>
                    </div>`;
            }

            // *** NEW: Pre-builds the submission links ***
            function buildSubmissionPage() {
                gatherFormData(); 
                const mailtoUrl = generateMailto();
                const whatsappUrl = generateWhatsAppLink();
                
                document.getElementById('resend-email-link-btn').href = mailtoUrl;
                document.getElementById('submit-whatsapp-link-btn').href = whatsappUrl;

                const name = formData.fullName.split(' ')[0] || 'Applicant';
                document.getElementById('last-step-greeting').textContent = `Last Step, ${name}!`;
                document.getElementById('thank-you-greeting').textContent = `Thank You, ${name}!`;
            }

            // --- *** NEW: Generates the full message body *** ---
            function getFullMessageBody() {
                gatherFormData(); 
                
                const name = formData.fullName;
                const email = formData.email;
                const position = formData.position;
                
                const langText = formData.languages.map(lang => {
                    const skills = [];
                    if (lang.read) skills.push('Read');
                    if (lang.write) skills.push('Write');
                    if (lang.speak) skills.push('Speak');
                    return `- ${lang.name} (${skills.join(', ')})`;
                }).join('\n');
                
                const expText = formData.experience.map(exp => {
                    return `- ${exp.role} at ${exp.company} (${exp.duration})`;
                }).join('\n');

                // This is the single source of truth for the message
                return `
--- HIRING MANAGER QUICK VIEW ---
Name: ${name}
Position: ${position}
Phone: ${formData.phone}
Salary: ${formData.salary}
Availability: ${formData.availability}
License: ${formData.skillLicense}
Needs Residence: ${formData.residentialSupport}
Heard Via: ${formData.howDidYouHear}
---------------------------------

--- ROLE FIT (KEY ANSWERS) ---

Why Clenzzo:
${formData.whyClenzzo}

--- Aptitude Questionnaire (${position}) ---

Q1: ${formData.questionSet[0]}
A: ${formData.situationalAnswer1}

Q2: ${formData.questionSet[1]}
A: ${formData.situationalAnswer2}

Q3: ${formData.questionSet[2]}
A: ${formData.situationalAnswer3}

Q4: ${formData.questionSet[3]}
A: ${formData.situationalAnswer4}

Q5: ${formData.questionSet[4]}
A: ${formData.situationalAnswer5}
---------------------------------

Dear Clenzzo Hiring Team,

I am writing to apply for the position of ${position}. Please find my full application details below.

--- FULL APPLICATION DETAILS ---

Personal Information:
- Name: ${name}
- Email: ${email}
- Phone: ${formData.phone}
- Marital Status: ${formData.maritalStatus}
- Place of Birth: ${formData.placeOfBirth}
- Address:
${formData.currentAddress}

Education & Experience:
- Qualification: ${formData.qualification}
- Discipline: ${formData.discipline || 'N/A'}
- Place of Education: ${formData.educationPlace}
- Experience: ${formData.hasExperience}
${expText}

Skills & Languages:
- Ride Motorcycle: ${formData.skillMotorcycle}
- Drive Car: ${formData.skillCar}
- License: ${formData.skillLicense}
- Languages:
${langText || 'N/A'}

Declarations & Reference:
- Availability: ${formData.availability}
- Criminal Cases: ${formData.criminalCase}
- Needs Residential Support: ${formData.residentialSupport}
- Heard About Us Via: ${formData.howDidYouHear}
- Reference: ${formData.referenceName} (${formData.referenceContact})

Additional Notes:
${formData.anythingElse || 'N/A'}

--- AGREEMENT ---
I confirm that I have read and agreed to the terms of engagement.

Thank you for your time and consideration.

Sincerely,
${name}
`;
            }

            function generateMailto() {
                const body = getFullMessageBody();
                const to = 'admin@clenzzo.com'; 
                const cc = formData.email;
                const subject = `Application: ${formData.position} - ${formData.fullName}`;
                return `mailto:${to}?cc=${encodeURIComponent(cc)}&subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            }

            // --- *** NEW: WhatsApp Link Generator *** ---
            function generateWhatsAppLink() {
                const body = getFullMessageBody();
                const phone = '918122213141'; // Your number with country code
                return `https://wa.me/${phone}?text=${encodeURIComponent(body)}`;
            }
            
            // --- localStorage ---
            const saveKey = 'clenzzoDraft_v9_whatsapp'; // Changed key
            function saveProgress() {
                gatherFormData();
                const state = {
                    formData,
                    segmentStatus,
                    firstName,
                    agreed: document.getElementById('agree-checkbox').checked
                };
                localStorage.setItem(saveKey, JSON.stringify(state));
            }
            
            function loadProgress() {
                const savedState = localStorage.getItem(saveKey);
                if (!savedState) {
                    navigateTo('welcome');
                    return;
                }
                
                const { formData: savedData, segmentStatus: savedStatus, firstName: savedFirstName, agreed } = JSON.parse(savedState);
                
                if (!agreed) { navigateTo('welcome'); return; }
                if (!savedData || !savedData.fullName) { navigateTo('nameCapture'); return; }
                
                formData = savedData;
                segmentStatus = savedStatus;
                firstName = savedFirstName;
                
                Object.keys(savedData).forEach(key => {
                    const el = document.getElementById(key);
                    if (el) el.value = savedData[key];
                    if (key === 'fullName') {
                        document.getElementById('fullName-q').value = savedData[key];
                        document.getElementById('fullName').value = savedData[key]; 
                    }
                });
                
                if (savedData.languages) savedData.languages.forEach(addLanguageField);
                if (savedData.hasExperience === 'Yes' && savedData.experience) {
                    savedData.experience.forEach(addExperienceField);
                }
                document.getElementById('agree-checkbox').checked = agreed;
                
                const continueBtn = document.getElementById('disclaimer-continue-btn');
                continueBtn.disabled = !agreed;
                continueBtn.classList.toggle('btn-disabled', !agreed);
                continueBtn.classList.toggle('btn-primary', agreed);
                
                document.getElementById('hub-greeting').textContent = `Welcome, ${firstName}!`;
                
                updatePositionDetails();
                triggerAllCounters();
                
                updateSegmentHub();
                navigateTo('segmentHub');
            }
            function clearProgress() { localStorage.removeItem(saveKey); }
            
            // --- Counters & Details ---
            function setupCounter(textareaId, counterId, maxLength) {
                const textarea = document.getElementById(textareaId);
                const counter = document.getElementById(counterId);
                if (!textarea || !counter) return;
                const update = () => {
                    counter.textContent = `${textarea.value.length} / ${maxLength}`;
                };
                textarea.addEventListener('keyup', update);
                textarea.addEventListener('change', update);
                update(); 
            }
            function triggerAllCounters() {
                setupCounter('whyClenzzo', 'whyClenzzo-counter', 300);
                setupCounter('situationalAnswer1', 'situationalAnswer1-counter', 250);
                setupCounter('situationalAnswer2', 'situationalAnswer2-counter', 250);
                setupCounter('situationalAnswer3', 'situationalAnswer3-counter', 250);
                setupCounter('situationalAnswer4', 'situationalAnswer4-counter', 250);
                setupCounter('situationalAnswer5', 'situationalAnswer5-counter', 250);
            }
            function updatePositionDetails() {
                if (!positionSelect) return;
                const qualification = positionQualifications[positionSelect.value];
                if (qualification && positionDetails) {
                    positionDetails.textContent = qualification;
                    positionDetails.classList.remove('hidden');
                } else if (positionDetails) {
                    positionDetails.classList.add('hidden');
                }
            }

            // --- INITIAL LOAD ---
            document.getElementById('current-year').textContent = new Date().getFullYear();
            setupValidationListeners(); 
            triggerAllCounters();
            
            if (positionSelect) {
                positionSelect.addEventListener('change', updatePositionDetails);
            }
            
            document.getElementById('add-language-btn').addEventListener('click', () => addLanguageField());
            document.getElementById('add-experience-btn').addEventListener('click', () => addExperienceField());

            loadProgress();
            
        });
    </script>
    
</body>
</html>
